<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="PMS.dao.AccountDao">
	<select id="isMember" resultType="string" parameterType="account">
		SELECT count(*)
		FROM account
		WHERE userno=#{userno}
	</select>
	<select id="loginCheck" resultType="string" parameterType="account">
		SELECT count(*)
		FROM account
		WHERE userno = #{userno}
		AND pw = #{pw}
	</select>
	<select id="getUserDetail" resultType="account" parameterType="account">
		SELECT *
		FROM account
		WHERE userno = #{userno}
	</select>
	<update id="uptPw" parameterType="account">
		UPDATE ACCOUNT 
		SET pw = #{pw}
		WHERE userno = #{userno}
	</update>
	<update id="uptUserInfo" parameterType="account">
		UPDATE ACCOUNT 
			SET email = #{email},
				address = #{address},
				birthdate = to_date(#{birthdateS},'YYYY-MM-DD'),
				hpnum = #{hpnum}
		WHERE userno = #{userno}
	</update>
	<select id="getMySList" resultType="mpsl" parameterType="string">
		SELECT distinct p2.title, s.sname, a.name, a.position
		FROM SCHEDULE s, SCHPARTICIPANT p, PROJECT p2, ACCOUNT a 
		WHERE s.sno in (
			SELECT SNO
			FROM SCHPARTICIPANT
			WHERE userno = #{userno})
		AND p2.pno in (
			SELECT PNO
			FROM SCHPARTICIPANT
			WHERE userno = #{userno}
		)
		AND p.userno = #{userno}
		AND a.userno in (
			SELECT p2.PMNO 
			FROM SCHEDULE s, SCHPARTICIPANT p, PROJECT p2
			WHERE s.sno in (
				SELECT SNO
				FROM SCHPARTICIPANT
				WHERE userno = #{userno})
			AND p2.pno in (
				SELECT PNO
				FROM SCHPARTICIPANT
				WHERE userno = #{userno}
			)
			AND p.userno = #{userno}
		)
	</select>
</mapper>


   